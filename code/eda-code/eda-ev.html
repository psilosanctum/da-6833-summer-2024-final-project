<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-07-12">

<title>EV Exploratory Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="eda-ev_files/libs/clipboard/clipboard.min.js"></script>
<script src="eda-ev_files/libs/quarto-html/quarto.js"></script>
<script src="eda-ev_files/libs/quarto-html/popper.min.js"></script>
<script src="eda-ev_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="eda-ev_files/libs/quarto-html/anchor.min.js"></script>
<link href="eda-ev_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="eda-ev_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="eda-ev_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="eda-ev_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="eda-ev_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">EV Exploratory Data Analysis</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 12, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p><strong>Electric Vehicle Data Analysis</strong></p>
<section id="introduction" class="level1">
<h1>Introduction:</h1>
<p>This document is an exploratory data analysis of electric vehicle data. The data was obtained from the IRS and contains information on electric vehicles, their owners, and the tax benefits they receive. The data was cleaned and processed in R and saved as a CSV file. This document will load the data, explore it, and fit a linear regression model to predict the number of electric vehicles in a given zip code.</p>
</section>
<section id="setup" class="level1">
<h1>Setup</h1>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load needed packages. make sure they are installed.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> read_csv, set_option, merge, DataFrame, concat, read_json</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression, LogisticRegression</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder, StandardScaler</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.gofplots <span class="im">import</span> ProbPlot</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geojson</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>set_option(<span class="st">'display.max_columns'</span>, <span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load the data.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>base_dir <span class="op">=</span> <span class="st">'../../'</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> read_csv(base_dir <span class="op">+</span> <span class="st">'data/processed-data/brand_model_year_tax_data.csv'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>columns_list <span class="op">=</span> df.columns.tolist()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> columns_list:</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(i.strip())</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="op">=</span> columns_list[<span class="dv">28</span>:]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>df.columns.tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>City
State
ZIPCODE
Model Year
Make
Model
Electric Vehicle Type
Clean Alternative Fuel Vehicle (CAFV) Eligibility
Electric Range
Vehicle Count
The State Federal Information Processing System (FIPS) code
The State associated with the ZIP code
Number of returns [3]
Number of single returns
Number of joint returns
Number of head of household returns
Number of electronically filed returns
Number of computer prepared paper returns
Number of returns with paid preparer's signature
Number of returns with direct deposit
Number of returns with virtual currency indicator
Number of individuals [4]
Total number of volunteer prepared returns [5]
Number of volunteer income tax assistance (VITA) prepared returns [5]
Number of tax counseling for the elderly (TCE) prepared returns [5]
Number of volunteer prepared returns with Earned Income Credit [5]
Number of refund anticipation check returns [6]
Number of elderly returns [7]
Adjust gross income (AGI) [8]
Total income amount
Salaries and wages amount
Taxable interest amount
Ordinary dividends amount
Qualified dividends amount [9]
State and local income tax refunds amount
Business or professional net income (less loss) amount
Net capital gain (less loss) amount
Taxable individual retirement arrangements distributions amount
Taxable pensions and annuities amount
Number of farm returns
Unemployment compensation amount [10]
Taxable Social Security benefits amount
Partnership/S-corp net income (less loss) amount
Total statutory adjustments amount
Educator expenses amount
Self-employed (Keogh) retirement plans amount
Self-employed health insurance deduction amount
Individual retirement arrangement payments amount
Student loan interest deduction amount
Charitable contributions if took standard deduction
Total standard deduction amount
Basic standard deduction amount
Additional standard deduction amount
Total itemized deductions amount
Amount of AGI for itemized returns
Total medical and dental expense deduction amount
State and local income taxes amount
State and local general sales tax amount
Real estate taxes amount
Personal property taxes amount
Limited state and local taxes
Total taxes paid amount
Home mortgage interest paid amount
Home mortgage from personal seller amount
Deductible points amount
Qualified mortgage insurance premiums amount
Investment interest paid amount
Total charitable contributions amount
Other non-limited miscellaneous deductions amount
Qualified business income deduction
Taxable income amount
Income tax before credits amount
Alternative minimum tax amount
Excess advance premium tax credit repayment amount
Total tax credits amount
Foreign tax credit amount
Child and dependent care credit amount
Nonrefundable education credit amount
Retirement savings contribution credit amount
Nonrefundable child and other dependent credit amount
Residential energy tax credit amount
Self-employment tax amount
Total premium tax credit amount
Advance premium tax credit amount
Total tax payments amount
Earned income credit amount [12]
Excess earned income credit (refundable) amount [13]
Refundable child tax credit or additional child tax credit amount
Refundable education credit amount
Net premium tax credit amount
Qualified sick and family leave credit for leave taken before April 1, 2021 amount
Refundable child and dependent care credit
Qualified sick and family leave credit for leave taken after March 31, 2021
Recovery rebate credit amount [15]
Economic impact payment third round amount [16, 17]
Income tax after credits amount
Total tax liability amount [18]
Additional Medicare tax amount
Net investment income tax amount
Tax due at time of filing amount [19]
Total overpayments amount
Overpayments refunded amount [20]
Credited to next year’s estimated tax amount</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>['City',
 'State',
 'ZIPCODE',
 'Model Year',
 'Make',
 'Model',
 'Electric Vehicle Type',
 'Clean Alternative Fuel Vehicle (CAFV) Eligibility',
 'Electric Range',
 'Vehicle Count',
 'The State Federal Information Processing System (FIPS) code',
 'The State associated with the ZIP code',
 'Number of returns [3]',
 'Number of single returns',
 'Number of joint returns',
 'Number of head of household returns',
 'Number of electronically filed returns',
 'Number of computer prepared paper returns',
 "Number of returns with paid preparer's signature",
 'Number of returns with direct deposit',
 'Number of returns with virtual currency indicator',
 'Number of individuals [4]',
 'Total number of volunteer prepared returns [5]',
 'Number of volunteer income tax assistance (VITA) prepared returns [5]',
 'Number of tax counseling for the elderly (TCE) prepared returns [5]',
 'Number of volunteer prepared returns with Earned Income Credit [5]',
 'Number of refund anticipation check returns [6]',
 'Number of elderly returns [7]',
 'Adjust gross income (AGI) [8]',
 'Total income amount',
 'Salaries and wages amount',
 'Taxable interest amount',
 'Ordinary dividends amount',
 'Qualified dividends amount [9]',
 'State and local income tax refunds amount',
 'Business or professional net income (less loss) amount',
 'Net capital gain (less loss) amount',
 'Taxable individual retirement arrangements distributions amount',
 'Taxable pensions and annuities amount',
 'Number of farm returns',
 'Unemployment compensation amount [10]',
 'Taxable Social Security benefits amount',
 'Partnership/S-corp net income (less loss) amount',
 'Total statutory adjustments amount',
 'Educator expenses amount',
 'Self-employed (Keogh) retirement plans amount',
 'Self-employed health insurance deduction amount',
 'Individual retirement arrangement payments amount',
 'Student loan interest deduction amount',
 'Charitable contributions if took standard deduction',
 'Total standard deduction amount',
 'Basic standard deduction amount',
 'Additional standard deduction amount',
 'Total itemized deductions amount',
 'Amount of AGI for itemized returns',
 'Total medical and dental expense deduction amount',
 'State and local income taxes amount',
 'State and local general sales tax amount',
 'Real estate taxes amount',
 'Personal property taxes amount',
 'Limited state and local taxes',
 'Total taxes paid amount',
 'Home mortgage interest paid amount',
 'Home mortgage from personal seller amount',
 'Deductible points amount',
 'Qualified mortgage insurance premiums amount',
 'Investment interest paid amount',
 'Total charitable contributions amount',
 'Other non-limited miscellaneous deductions amount',
 'Qualified business income deduction',
 'Taxable income amount',
 'Income tax before credits amount',
 'Alternative minimum tax amount',
 'Excess advance premium tax credit repayment amount',
 'Total tax credits amount',
 'Foreign tax credit amount',
 'Child and dependent care credit amount',
 'Nonrefundable education credit amount',
 'Retirement savings contribution credit amount',
 'Nonrefundable child and other dependent credit amount',
 'Residential energy tax credit amount',
 'Self-employment tax amount',
 'Total premium tax credit amount',
 'Advance premium tax credit amount',
 'Total tax payments amount',
 'Earned income credit amount [12]  ',
 'Excess earned income credit (refundable) amount [13]  ',
 'Refundable child tax credit or additional child tax credit amount',
 'Refundable education credit amount',
 'Net premium tax credit amount',
 'Qualified sick and family leave credit for leave taken before April 1, 2021 amount',
 'Refundable child and dependent care credit',
 'Qualified sick and family leave credit for leave taken after March 31, 2021',
 'Recovery rebate credit amount [15]',
 'Economic impact payment third round amount [16, 17]',
 'Income tax after credits amount   ',
 'Total tax liability amount [18]  ',
 'Additional Medicare tax amount',
 'Net investment income tax amount',
 'Tax due at time of filing amount [19]  ',
 'Total overpayments amount',
 'Overpayments refunded amount [20]  ',
 'Credited to next year’s estimated tax amount']</code></pre>
</div>
</div>
<p>Vehicle Brand Aggregation</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">'darkgrid'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>zip_code_count <span class="op">=</span> df.groupby([<span class="st">'ZIPCODE'</span>]).agg({</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Vehicle Count'</span>: <span class="st">'sum'</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The figure contains two histograms showing the distribution of vehicle counts by ZIP code. The top plot displays the original distribution, with most ZIP codes having a lower vehicle count and a few having very high counts, resulting in a skewed distribution. The bottom plot shows the log-transformed distribution, which spreads out the data and makes it easier to visualize lower counts. Both plots use a horizontal bar layout for easy comparison.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">15</span>))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(ax<span class="op">=</span>axes[<span class="dv">0</span>], data<span class="op">=</span>zip_code_count, y<span class="op">=</span>zip_code_count[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>log_zip_code_count <span class="op">=</span> zip_code_count.copy()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>log_zip_code_count[<span class="st">'Vehicle Count'</span>] <span class="op">=</span> np.log(zip_code_count[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>sns.histplot(ax<span class="op">=</span>axes[<span class="dv">1</span>], data<span class="op">=</span>log_zip_code_count, y<span class="op">=</span>log_zip_code_count[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>zip_code_count</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ZIPCODE</th>
<th data-quarto-table-cell-role="th">Vehicle Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>98001</td>
<td>258</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>98002</td>
<td>132</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>98003</td>
<td>181</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>98004</td>
<td>916</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>98005</td>
<td>433</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">456</td>
<td>99360</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">457</td>
<td>99361</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">458</td>
<td>99362</td>
<td>142</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">459</td>
<td>99402</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">460</td>
<td>99403</td>
<td>19</td>
</tr>
</tbody>
</table>

<p>461 rows × 2 columns</p>
</div>
</div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-5-output-2.png" width="1191" height="1167"></p>
</div>
</div>
<p>The image shows two box plots of vehicle counts by ZIP code. The top plot displays the original vehicle counts, revealing most counts below 200 with many outliers up to 1000. The bottom plot uses log-transformed vehicle counts, normalizing the data and reducing the impact of outliers. Both plots highlight the distribution, central tendency, and variability of vehicle counts across ZIP codes.</p>
<section id="to-do" class="level3">
<h3 class="anchored" data-anchor-id="to-do">TO DO</h3>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># us_zips_df = read_csv(base_dir + 'data/raw-data/uszips.csv')</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># wa_zips = us_zips_df.loc[us_zips_df['state_id'] == 'WA']</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># wa_zips = wa_zips[['ZIPCODE', 'lat', 'lng', 'population']]</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># merge_zips = merge(wa_zips, zip_code_count, on='ZIPCODE')</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # print(merge_zips)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># test = base_dir + 'data/raw-data/counties.geojson'</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># with open(test) as f:</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     gj = geojson.load(f)</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(gj['features'])</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># countries = ["53"]</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># new_list = []</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># features = gj['features'][0]['properties']['STATEFP']</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># features = gj['features']</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># print(features[0])</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># for i in features:</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     # print(i)</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     if i['properties']['STATEFP'] == '53':</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#         new_list.append(i)</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     else:</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#         pass</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co"># final = json.dumps(new_list, indent=2)</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co"># print(gj)</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co"># mapit = folium.Map(location=[122.511983, 37.77113])</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># for i in features:</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     if i['properties']['STATEFP'] == '53':</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(i)</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">#         folium.Choropleth(geo_data=i['geometry']['coordinates'][0][0],</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co">#             data=merge_zips,</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co">#             columns=['lat', 'lng', 'Vehicle Count'],</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">#             key_on='geometry.coordinates',</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">#             fill_color='magma',</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co">#             line_color='magma'</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co">#         ).add_to(mapit)</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co"># mapit.save('test.html')</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co"># coordinates = []</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co"># for zip_code in zip_code_count['ZIPCODE']:</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(zip_code)</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co">#     geocode_result = geopandas.</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># geocode_result = gmaps.geocode(zip_code)</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># lat = geocode_result[0][‘geometry’][‘location’][‘lat’]</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># lng = geocode_result[0][‘geometry’][‘location’][‘lng’]</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># coordinates.append((lat, lng))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>betctuun fig, axes = plt.subplots(2, 1, figsize=(15,15)) sns.boxplot(ax=axes[0], data=zip_code_count, x=zip_code_count['Vehicle Count']) log_zip_code_count = zip_code_count.copy() log_zip_code_count['Vehicle Count'] = np.log(zip_code_count['Vehicle Count']) sns.boxplot(ax=axes[1], data=log_zip_code_count, x=log_zip_code_count['Vehicle Count'])</code></p>
<p>MAKE AND ELECTRIC VEHICLE TYPE</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">'darkgrid'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>make_ev_type <span class="op">=</span> df.groupby([<span class="st">'Make'</span>]).agg({</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Vehicle Count'</span>: <span class="st">'sum'</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">15</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>sns.histplot(ax<span class="op">=</span>axes[<span class="dv">0</span>], data<span class="op">=</span>make_ev_type, y<span class="op">=</span>make_ev_type[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>log_make_ev_type <span class="op">=</span> make_ev_type.copy()</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>log_make_ev_type[<span class="st">'Vehicle Count'</span>] <span class="op">=</span> np.log(make_ev_type[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>sns.histplot(ax<span class="op">=</span>axes[<span class="dv">1</span>], data<span class="op">=</span>log_make_ev_type, y<span class="op">=</span>log_make_ev_type[<span class="st">'Vehicle Count'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>&lt;Axes: xlabel='Count', ylabel='Vehicle Count'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-7-output-2.png" width="1199" height="1167"></p>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">15</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">0</span>], data<span class="op">=</span>make_ev_type)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>log_make_ev_type <span class="op">=</span> make_ev_type.copy()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>log_make_ev_type[<span class="st">'Vehicle Count'</span>] <span class="op">=</span> np.log(make_ev_type[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">1</span>], data<span class="op">=</span>log_make_ev_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>&lt;Axes: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-8-output-2.png" width="1182" height="1149"></p>
</div>
</div>
<p>MAKE AND Clean Alt Fuel</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">'darkgrid'</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>make_ev_type <span class="op">=</span> df.groupby([<span class="st">'Make'</span>, <span class="st">'Clean Alternative Fuel Vehicle (CAFV) Eligibility'</span>]).agg({</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Vehicle Count'</span>: <span class="st">'sum'</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">15</span>))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>sns.histplot(ax<span class="op">=</span>axes[<span class="dv">0</span>], data<span class="op">=</span>make_ev_type, y<span class="op">=</span>make_ev_type[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>log_make_ev_type <span class="op">=</span> make_ev_type.copy()</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>log_make_ev_type[<span class="st">'Vehicle Count'</span>] <span class="op">=</span> np.log(make_ev_type[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>sns.histplot(ax<span class="op">=</span>axes[<span class="dv">1</span>], data<span class="op">=</span>log_make_ev_type, y<span class="op">=</span>log_make_ev_type[<span class="st">'Vehicle Count'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>&lt;Axes: xlabel='Count', ylabel='Vehicle Count'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-9-output-2.png" width="1199" height="1167"></p>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">15</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">0</span>], data<span class="op">=</span>make_ev_type, x<span class="op">=</span>make_ev_type[<span class="st">'Clean Alternative Fuel Vehicle (CAFV) Eligibility'</span>], y<span class="op">=</span>make_ev_type[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>log_make_ev_type <span class="op">=</span> make_ev_type.copy()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>log_make_ev_type[<span class="st">'Vehicle Count'</span>] <span class="op">=</span> np.log(make_ev_type[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">1</span>], data<span class="op">=</span>log_make_ev_type, x<span class="op">=</span>make_ev_type[<span class="st">'Clean Alternative Fuel Vehicle (CAFV) Eligibility'</span>], y<span class="op">=</span>log_make_ev_type[<span class="st">'Vehicle Count'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>&lt;Axes: xlabel='Clean Alternative Fuel Vehicle (CAFV) Eligibility', ylabel='Vehicle Count'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-10-output-2.png" width="1199" height="1167"></p>
</div>
</div>
<p>Mean</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>brand_df <span class="op">=</span> df[[</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a> <span class="st">'Residential energy tax credit amount'</span>, <span class="st">'Total income amount'</span>, <span class="st">'Vehicle Count'</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>]]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">15</span>))</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>sns.heatmap(data<span class="op">=</span>brand_df)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>brand_df.corr()</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># brand_df['Electric Range'] = np.log(brand_df['Electric Range'])</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.boxplot(ax=axes[1], data=brand_df, y=brand_df['Electric Range'])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Residential energy tax credit amount</th>
<th data-quarto-table-cell-role="th">Total income amount</th>
<th data-quarto-table-cell-role="th">Vehicle Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Residential energy tax credit amount</td>
<td>1.000000</td>
<td>0.503153</td>
<td>0.154667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Total income amount</td>
<td>0.503153</td>
<td>1.000000</td>
<td>0.213034</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Vehicle Count</td>
<td>0.154667</td>
<td>0.213034</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-11-output-2.png" width="1098" height="1163"></p>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>new_brand_df  <span class="op">=</span> df.groupby([<span class="st">'ZIPCODE'</span>]).agg({</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Total income amount'</span>: <span class="st">'sum'</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Electric Range'</span>: <span class="st">'count'</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>}).reset_index(drop<span class="op">=</span><span class="va">True</span>).rename(columns<span class="op">=</span>{</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Electric Range'</span>: <span class="st">'Vehicle Count'</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">15</span>))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>new_brand_df[<span class="st">'Total income amount'</span>] <span class="op">=</span> new_brand_df[<span class="st">'Total income amount'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>slope, intercept, r_value, p_value, std_err <span class="op">=</span> stats.linregress(new_brand_df[<span class="st">'Total income amount'</span>],new_brand_df[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>sns.regplot(ax<span class="op">=</span>axes[<span class="dv">0</span>], data<span class="op">=</span>new_brand_df, y<span class="op">=</span><span class="st">'Vehicle Count'</span>, x<span class="op">=</span><span class="st">'Total income amount'</span>, </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    ci<span class="op">=</span><span class="va">None</span>, </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="ss">f"y=</span><span class="sc">{</span><span class="dv">0</span><span class="sc">:.1f}</span><span class="ss">x+</span><span class="sc">{</span><span class="dv">1</span><span class="sc">:.1f}</span><span class="ch">\n</span><span class="ss">r-sq: </span><span class="sc">{</span>r_value<span class="sc">.</span><span class="bu">round</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="ss">"</span>.<span class="bu">format</span>(slope, intercept)).legend(loc<span class="op">=</span><span class="st">"best"</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>new_brand_df[<span class="st">'Vehicle Count'</span>] <span class="op">=</span> np.log(new_brand_df[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>new_brand_df[<span class="st">'Total income amount'</span>] <span class="op">=</span> np.log(new_brand_df[<span class="st">'Total income amount'</span>])</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>slope, intercept, r_value, p_value, std_err <span class="op">=</span> stats.linregress(new_brand_df[<span class="st">'Total income amount'</span>],new_brand_df[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>sns.regplot(ax<span class="op">=</span>axes[<span class="dv">1</span>],</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>new_brand_df,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'Total income amount'</span>,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'Vehicle Count'</span>, </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    ci<span class="op">=</span><span class="va">None</span>, </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="ss">f"y=</span><span class="sc">{</span><span class="dv">0</span><span class="sc">:.1f}</span><span class="ss">x+</span><span class="sc">{</span><span class="dv">1</span><span class="sc">:.1f}</span><span class="ch">\n</span><span class="ss">r-sq: </span><span class="sc">{</span>r_value<span class="sc">.</span><span class="bu">round</span>(<span class="dv">3</span>)<span class="sc">}</span><span class="ss">"</span>.<span class="bu">format</span>(slope, intercept)).legend(loc<span class="op">=</span><span class="st">"best"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>&lt;matplotlib.legend.Legend at 0x13c801610&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-12-output-2.png" width="1184" height="1167"></p>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>base_dir <span class="op">=</span> <span class="st">'../../'</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> read_csv(base_dir <span class="op">+</span> <span class="st">'data/processed-data/brand_model_year_tax_data.csv'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>columns_list <span class="op">=</span> df.columns.tolist()</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> columns_list:</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(i.strip())</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># numeric_cols = columns_list[28:]</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># df.columns.tolist()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>City
State
ZIPCODE
Model Year
Make
Model
Electric Vehicle Type
Clean Alternative Fuel Vehicle (CAFV) Eligibility
Electric Range
Vehicle Count
The State Federal Information Processing System (FIPS) code
The State associated with the ZIP code
Number of returns [3]
Number of single returns
Number of joint returns
Number of head of household returns
Number of electronically filed returns
Number of computer prepared paper returns
Number of returns with paid preparer's signature
Number of returns with direct deposit
Number of returns with virtual currency indicator
Number of individuals [4]
Total number of volunteer prepared returns [5]
Number of volunteer income tax assistance (VITA) prepared returns [5]
Number of tax counseling for the elderly (TCE) prepared returns [5]
Number of volunteer prepared returns with Earned Income Credit [5]
Number of refund anticipation check returns [6]
Number of elderly returns [7]
Adjust gross income (AGI) [8]
Total income amount
Salaries and wages amount
Taxable interest amount
Ordinary dividends amount
Qualified dividends amount [9]
State and local income tax refunds amount
Business or professional net income (less loss) amount
Net capital gain (less loss) amount
Taxable individual retirement arrangements distributions amount
Taxable pensions and annuities amount
Number of farm returns
Unemployment compensation amount [10]
Taxable Social Security benefits amount
Partnership/S-corp net income (less loss) amount
Total statutory adjustments amount
Educator expenses amount
Self-employed (Keogh) retirement plans amount
Self-employed health insurance deduction amount
Individual retirement arrangement payments amount
Student loan interest deduction amount
Charitable contributions if took standard deduction
Total standard deduction amount
Basic standard deduction amount
Additional standard deduction amount
Total itemized deductions amount
Amount of AGI for itemized returns
Total medical and dental expense deduction amount
State and local income taxes amount
State and local general sales tax amount
Real estate taxes amount
Personal property taxes amount
Limited state and local taxes
Total taxes paid amount
Home mortgage interest paid amount
Home mortgage from personal seller amount
Deductible points amount
Qualified mortgage insurance premiums amount
Investment interest paid amount
Total charitable contributions amount
Other non-limited miscellaneous deductions amount
Qualified business income deduction
Taxable income amount
Income tax before credits amount
Alternative minimum tax amount
Excess advance premium tax credit repayment amount
Total tax credits amount
Foreign tax credit amount
Child and dependent care credit amount
Nonrefundable education credit amount
Retirement savings contribution credit amount
Nonrefundable child and other dependent credit amount
Residential energy tax credit amount
Self-employment tax amount
Total premium tax credit amount
Advance premium tax credit amount
Total tax payments amount
Earned income credit amount [12]
Excess earned income credit (refundable) amount [13]
Refundable child tax credit or additional child tax credit amount
Refundable education credit amount
Net premium tax credit amount
Qualified sick and family leave credit for leave taken before April 1, 2021 amount
Refundable child and dependent care credit
Qualified sick and family leave credit for leave taken after March 31, 2021
Recovery rebate credit amount [15]
Economic impact payment third round amount [16, 17]
Income tax after credits amount
Total tax liability amount [18]
Additional Medicare tax amount
Net investment income tax amount
Tax due at time of filing amount [19]
Total overpayments amount
Overpayments refunded amount [20]
Credited to next year’s estimated tax amount</code></pre>
</div>
</div>
<p>ZIP CODE ONLY</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>amount_brand_df <span class="op">=</span> df.groupby([<span class="st">'ZIPCODE'</span>])[numeric_cols].mean(numeric_only<span class="op">=</span><span class="va">True</span>).reset_index()</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>brand_df <span class="op">=</span> df.groupby([<span class="st">'ZIPCODE'</span>]).agg({</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Vehicle Count'</span>: <span class="st">'sum'</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Electric Range'</span>: <span class="st">'mean'</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> merge(brand_df, amount_brand_df, on<span class="op">=</span>[<span class="st">'ZIPCODE'</span>])</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> merged_df.sort_values(<span class="st">'Vehicle Count'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>X_df <span class="op">=</span> merged_df</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>Y_df <span class="op">=</span> merged_df[[<span class="st">'Vehicle Count'</span>]]</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>Y_df <span class="op">=</span> np.log(Y_df)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>X_df <span class="op">=</span> merged_df.drop([<span class="st">'Vehicle Count'</span>, <span class="st">'Electric Range'</span>, <span class="st">'ZIPCODE'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.array(X_df)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> np.array(Y_df)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(x,Y, </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                                   random_state<span class="op">=</span><span class="dv">104</span>,  </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                                   test_size<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                                   shuffle<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train.shape)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train.shape)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y_train, X_train)</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> model.fit()</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>results.summary()</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>p_values <span class="op">=</span> results.pvalues</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>p_df <span class="op">=</span> DataFrame()</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>p_df[<span class="st">'Feature'</span>] <span class="op">=</span> X_df.columns</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>p_df[<span class="st">'p-value'</span>] <span class="op">=</span> results.pvalues[<span class="dv">1</span>:]</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>feat_list <span class="op">=</span> []</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>p_val_list <span class="op">=</span> []</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> p_df.iterrows():</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="st">'p-value'</span>] <span class="op">&lt;</span> <span class="fl">.05</span>:</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>        feat_list.append(row[<span class="st">'Feature'</span>])</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>        p_val_list.append(row[<span class="st">'p-value'</span>])</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>new_p_df <span class="op">=</span> DataFrame()</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>new_p_df[<span class="st">'Feature'</span>] <span class="op">=</span> feat_list</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>new_p_df[<span class="st">'p-value'</span>] <span class="op">=</span> p_val_list</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.array(X_df[new_p_df[<span class="st">'Feature'</span>]])</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> np.array(Y_df)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(x,Y, </span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>                                   random_state<span class="op">=</span><span class="dv">104</span>,  </span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>                                   test_size<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>                                   shuffle<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> sm.OLS(y_train, X_train)</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>results2 <span class="op">=</span> model2.fit()</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>results2.summary()</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>p3_values <span class="op">=</span> results2.pvalues</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>new3 <span class="op">=</span> DataFrame()</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>new3[<span class="st">'Feature'</span>] <span class="op">=</span> new_p_df[<span class="st">'Feature'</span>]</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>new3[<span class="st">'p-value'</span>] <span class="op">=</span> p3_values[<span class="dv">1</span>:]</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>new3</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>feat_list3 <span class="op">=</span> []</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>p_val_list3 <span class="op">=</span> []</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> new3.iterrows():</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[<span class="st">'p-value'</span>] <span class="op">&lt;</span> <span class="fl">.05</span>:</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>        feat_list3.append(row[<span class="st">'Feature'</span>])</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>        p_val_list3.append(row[<span class="st">'p-value'</span>])</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>final3_df <span class="op">=</span> DataFrame()</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>final3_df[<span class="st">'Feature'</span>] <span class="op">=</span> feat_list3</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>final3_df[<span class="st">'p-value'</span>] <span class="op">=</span> p_val_list3</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>final3_df</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.array(X_df[final3_df[<span class="st">'Feature'</span>]])</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> np.array(Y_df)</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(x,Y, </span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>                                   random_state<span class="op">=</span><span class="dv">104</span>,  </span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>                                   test_size<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>                                   shuffle<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>model3 <span class="op">=</span> sm.OLS(y_train, X_train)</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>results3 <span class="op">=</span> model3.fit()</span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>Y_pred <span class="op">=</span> results3.predict(X_train).astype(<span class="bu">int</span>)</span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> [<span class="st">'constant'</span>] <span class="op">+</span> final3_df[<span class="st">'Feature'</span>].tolist()</span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> DataFrame(X_train, columns<span class="op">=</span>features)</span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> DataFrame(y_train, columns<span class="op">=</span>[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>dataframe <span class="op">=</span> concat([X, Y], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>dataframe</span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>results3.summary()</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>features</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(368, 76)
(368, 1)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>['constant',
 'Adjust gross income (AGI) [8]',
 'Total income amount',
 'State and local income tax refunds amount',
 'Taxable pensions and annuities amount',
 'Total statutory adjustments amount',
 'Self-employed (Keogh) retirement plans amount',
 'Total standard deduction amount',
 'Basic standard deduction amount',
 'Additional standard deduction amount',
 'Alternative minimum tax amount',
 'Child and dependent care credit amount']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model values</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>model_fitted_y <span class="op">=</span> results3.fittedvalues</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># model residuals</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>model_residuals <span class="op">=</span> results3.resid</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># normalized residuals</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>model_norm_residuals <span class="op">=</span> results3.get_influence().resid_studentized_internal</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># absolute squared normalized residuals</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>model_norm_residuals_abs_sqrt <span class="op">=</span> np.sqrt(np.<span class="bu">abs</span>(model_norm_residuals))</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># absolute residuals</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>model_abs_resid <span class="op">=</span> np.<span class="bu">abs</span>(model_residuals)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co"># leverage, from statsmodels internals</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>model_leverage <span class="op">=</span> results3.get_influence().hat_matrix_diag</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co"># cook's distance, from statsmodels internals</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>model_cooks <span class="op">=</span> results3.get_influence().cooks_distance[<span class="dv">0</span>]</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>plot_lm_1 <span class="op">=</span> plt.figure()</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>plot_lm_1.axes[<span class="dv">0</span>] <span class="op">=</span> sns.residplot(x<span class="op">=</span>model_fitted_y, y<span class="op">=</span>dataframe.columns[<span class="op">-</span><span class="dv">1</span>], data<span class="op">=</span>dataframe,</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>                          lowess<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>                          scatter_kws<span class="op">=</span>{<span class="st">'alpha'</span>: <span class="fl">0.5</span>},</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>                          line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'red'</span>, <span class="st">'lw'</span>: <span class="dv">1</span>, <span class="st">'alpha'</span>: <span class="fl">0.8</span>})</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>plot_lm_1.axes[<span class="dv">0</span>].set_title(<span class="st">'Residuals vs Fitted'</span>)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>plot_lm_1.axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Fitted values'</span>)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>plot_lm_1.axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Residuals'</span>)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> DataFrame()</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'res'</span>] <span class="op">=</span> model_residuals</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'fitted'</span>] <span class="op">=</span> model_fitted_y</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'count'</span>] <span class="op">=</span> dataframe[<span class="st">'Vehicle Count'</span>]</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="co"># df['ZIPCODE'] = dataframe['ZIPCODE']</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>maxr <span class="op">=</span> np.<span class="bu">max</span>(model_residuals)</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>df.sort_values(<span class="st">'fitted'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">res</th>
<th data-quarto-table-cell-role="th">fitted</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">92</td>
<td>-1.574220</td>
<td>8.568153</td>
<td>6.993933</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">317</td>
<td>-1.506110</td>
<td>8.143368</td>
<td>6.637258</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">142</td>
<td>-0.758350</td>
<td>8.025177</td>
<td>7.266827</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">104</td>
<td>-1.119208</td>
<td>7.939224</td>
<td>6.820016</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">359</td>
<td>-1.153209</td>
<td>7.925144</td>
<td>6.771936</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">282</td>
<td>-0.470297</td>
<td>0.470297</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">315</td>
<td>0.920935</td>
<td>0.465360</td>
<td>1.386294</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">255</td>
<td>-0.280249</td>
<td>0.280249</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">149</td>
<td>0.745540</td>
<td>-0.052393</td>
<td>0.693147</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">253</td>
<td>1.227998</td>
<td>-0.129386</td>
<td>1.098612</td>
</tr>
</tbody>
</table>

<p>368 rows × 3 columns</p>
</div>
</div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-15-output-2.png" width="582" height="447"></p>
</div>
</div>
<section id="normal-q-q-plot" class="level4">
<h4 class="anchored" data-anchor-id="normal-q-q-plot">Normal Q-Q Plot</h4>
<p>This plot shows if the residuals are normally distributed. A good normal QQ plot has all of the residuals lying on or close to the red line.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>QQ <span class="op">=</span> ProbPlot(model_norm_residuals)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>plot_lm_2 <span class="op">=</span> QQ.qqplot(line<span class="op">=</span><span class="st">'45'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'#4C72B0'</span>, lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>plot_lm_2.axes[<span class="dv">0</span>].set_title(<span class="st">'Normal Q-Q'</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>plot_lm_2.axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Theoretical Quantiles'</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>plot_lm_2.axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Standardized Residuals'</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># annotations</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>abs_norm_resid <span class="op">=</span> np.flip(np.argsort(np.<span class="bu">abs</span>(model_norm_residuals)), <span class="dv">0</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>abs_norm_resid_top_3 <span class="op">=</span> abs_norm_resid[:<span class="dv">3</span>]</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r, i <span class="kw">in</span> <span class="bu">enumerate</span>(abs_norm_resid_top_3):</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    plot_lm_2.axes[<span class="dv">0</span>].annotate(i,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                               xy<span class="op">=</span>(np.flip(QQ.theoretical_quantiles, <span class="dv">0</span>)[r],</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                                   model_norm_residuals[i]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-16-output-1.png" width="582" height="447"></p>
</div>
</div>
</section>
<section id="scale-location" class="level4">
<h4 class="anchored" data-anchor-id="scale-location">Scale-Location</h4>
<p>This plot is a way to check if the residuals suffer from non-constant variance, aka heteroscedasticity.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>plot_lm_3 <span class="op">=</span> plt.figure()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(model_fitted_y, model_norm_residuals_abs_sqrt, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>sns.regplot(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>model_fitted_y, </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>model_norm_residuals_abs_sqrt,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    scatter<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    ci<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    lowess<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'red'</span>, <span class="st">'lw'</span>: <span class="dv">1</span>, <span class="st">'alpha'</span>: <span class="fl">0.8</span>})</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>plot_lm_3.axes[<span class="dv">0</span>].set_title(<span class="st">'Scale-Location'</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>plot_lm_3.axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Fitted values'</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>plot_lm_3.axes[<span class="dv">0</span>].set_ylabel(<span class="st">'$\sqrt{|Standardized Residuals|}$'</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># annotations</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>abs_sq_norm_resid <span class="op">=</span> np.flip(np.argsort(model_norm_residuals_abs_sqrt), <span class="dv">0</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>abs_sq_norm_resid_top_3 <span class="op">=</span> abs_sq_norm_resid[:<span class="dv">3</span>]</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r, i <span class="kw">in</span> <span class="bu">enumerate</span>(abs_sq_norm_resid_top_3):</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    plot_lm_3.axes[<span class="dv">0</span>].annotate(</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        i,</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=</span>(model_fitted_y[i],</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>        model_norm_residuals_abs_sqrt[i]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-17-output-1.png" width="594" height="447"></p>
</div>
</div>
</section>
<section id="residuals-vs.-leverage" class="level4">
<h4 class="anchored" data-anchor-id="residuals-vs.-leverage">Residuals vs.&nbsp;Leverage</h4>
<p>Unlike outliers, which have an unusually large y value, leverage points have extreme x values. This may not seem so bad at face value, but it can have damaging effects on the model because the β coefficients are very sensitive to leverage points. The purpose of the Residuals vs Leverage plot is to identify these problematic observations.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>plot_lm_4 <span class="op">=</span> plt.figure()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(model_leverage, model_norm_residuals, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>sns.regplot(x<span class="op">=</span>model_leverage, y<span class="op">=</span>model_norm_residuals,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>            scatter<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>            ci<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>            lowess<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'red'</span>, <span class="st">'lw'</span>: <span class="dv">1</span>, <span class="st">'alpha'</span>: <span class="fl">0.8</span>})</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>plot_lm_4.axes[<span class="dv">0</span>].set_xlim(<span class="dv">0</span>, np.<span class="bu">max</span>(model_leverage)<span class="op">+</span><span class="fl">0.01</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>plot_lm_4.axes[<span class="dv">0</span>].set_ylim(<span class="op">-</span><span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>plot_lm_4.axes[<span class="dv">0</span>].set_title(<span class="st">'Residuals vs Leverage'</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>plot_lm_4.axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Leverage'</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>plot_lm_4.axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Standardized Residuals'</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"># annotations</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>leverage_top_3 <span class="op">=</span> np.flip(np.argsort(model_cooks), <span class="dv">0</span>)[:<span class="dv">3</span>]</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> leverage_top_3:</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    plot_lm_4.axes[<span class="dv">0</span>].annotate(i,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>                                xy<span class="op">=</span>(model_leverage[i],</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>                                    model_norm_residuals[i]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-18-output-1.png" width="594" height="447"></p>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cookdplot(model, ax<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    cooks_d <span class="op">=</span> model.get_influence().cooks_distance[<span class="dv">0</span>]</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    ax.vlines(<span class="bu">range</span>(<span class="bu">len</span>(cooks_d)),<span class="dv">0</span>,cooks_d)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotations</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    cookd_top_3 <span class="op">=</span> np.flip(np.argsort(cooks_d), <span class="dv">0</span>)[:<span class="dv">3</span>]</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> cookd_top_3:</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>        ax.annotate(i, xy<span class="op">=</span>(i, cooks_d[i]),color <span class="op">=</span> <span class="st">'C3'</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">"Cook's Distance"</span> , fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Obs. Number'</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">"Cook's distance"</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ax</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>cookdplot(results3)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-19-output-1.png" width="593" height="447"></p>
</div>
</div>
</section>
</section>
<section id="second-model" class="level3">
<h3 class="anchored" data-anchor-id="second-model">SECOND MODEL</h3>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merged_df = merged_df.loc[(merged_df['Vehicle Count'] != 1.94591)]</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print(merged_df.loc[merged_df['Vehicle Count'] &lt; 5].sort_values('Vehicle Count', ascending=False).head(30))</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>X_df <span class="op">=</span> merged_df.copy()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>Y_df <span class="op">=</span> merged_df[[<span class="st">'Vehicle Count'</span>]]</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>Y_df <span class="op">=</span> np.log(Y_df)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>X_features <span class="op">=</span> [</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  'Adjust gross income (AGI) [8]',</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  'Total income amount',</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'State and local income tax refunds amount'</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  'Taxable pensions and annuities amount',</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'Number of farm returns'</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'Total statutory adjustments amount'</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'Self-employed (Keogh) retirement plans amount'</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'Total standard deduction amount'</span>,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co">#  'Basic standard deduction amount',</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">#  'Additional standard deduction amount',</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">#  'Total medical and dental expense deduction amount',</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'Limited state and local taxes'</span>,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'Home mortgage from personal seller amount'</span>,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'Alternative minimum tax amount'</span>,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'Child and dependent care credit amount'</span>,</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co">#  'Net premium tax credit amount',</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co">#  'Qualified sick and family leave credit for leave taken before April 1, 2021 amount',</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="co">#  'Credited to next year’s estimated tax amount'</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a> ]</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>X_df <span class="op">=</span> X_df[X_features]</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>feat_list <span class="op">=</span> []</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>log_list <span class="op">=</span> []</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feat <span class="kw">in</span> X_features:</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    feat_list.append(feat)</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    log_list.append(np.log(X_df[feat]))</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="co"># X_features = ['ZIPCODE',</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="co">#  'Adjust gross income (AGI) [8]',</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="co">#  'Total income amount',</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a><span class="co">#  'Total statutory adjustments amount',</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="co">#  'Home mortgage from personal seller amount',</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="co">#  'Alternative minimum tax amount']</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> X_df[X_features]</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> Y_df</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(x,Y, </span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>                                   random_state<span class="op">=</span><span class="dv">104</span>,  </span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>                                   test_size<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>                                   shuffle<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_train)</span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y_train, X_train)</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>results2mod <span class="op">=</span> model.fit()</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Y_pred = results2mod.predict(X_test).astype(int)</span></span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>results2mod.summary()</span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>model1 <span class="op">=</span> LinearRegression().fit(X_train, y_train)</span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>model1.score(X_train, y_train)</span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a><span class="co"># model1.score(X_test, y_test)</span></span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a><span class="co"># results2mod.summary()</span></span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> DataFrame(X_train, columns<span class="op">=</span>[<span class="st">'constant'</span>] <span class="op">+</span> X_features)</span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> DataFrame(y_train, columns<span class="op">=</span>[<span class="st">'Vehicle Count'</span>])</span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>dataframe <span class="op">=</span> concat([X, Y], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a><span class="co"># dataframe</span></span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>results2mod.summary()</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a><span class="co"># model1 = LinearRegression().fit(X_train, y_train)</span></span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a><span class="co"># model1.score(X_train, y_train)</span></span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a><span class="co"># model1.score(X_test, y_test)</span></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a><span class="co"># model.coef_</span></span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a><span class="co"># model.intercept_</span></span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Y_pred = model1.predict(X_test)</span></span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.scatter(x=y_test, y=Y_pred)</span></span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.plot(y_test, Y_pred, color='red')    </span></span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.regplot(x=y_test, y=Y_pred)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     const  State and local income tax refunds amount  Number of farm returns  \
183    1.0                                        0.0                    22.0   
122    1.0                                        0.0                     0.0   
60     1.0                                       94.0                     0.0   
204    1.0                                       58.0                     0.0   
328    1.0                                        0.0                    84.0   
..     ...                                        ...                     ...   
123    1.0                                        0.0                     0.0   
160    1.0                                        0.0                     0.0   
200    1.0                                        0.0                     0.0   
427    1.0                                       19.0                    25.0   
16     1.0                                       16.0                     0.0   

     Total statutory adjustments amount  \
183                              7807.0   
122                             10592.0   
60                              19325.0   
204                             12899.0   
328                              1710.0   
..                                  ...   
123                              6654.0   
160                              1364.0   
200                              5421.0   
427                              9955.0   
16                              16625.0   

     Self-employed (Keogh) retirement plans amount  \
183                                         1017.0   
122                                          760.0   
60                                          6027.0   
204                                         3271.0   
328                                            0.0   
..                                             ...   
123                                          418.0   
160                                            0.0   
200                                         1594.0   
427                                         1017.0   
16                                          1843.0   

     Total standard deduction amount  Limited state and local taxes  \
183                         198199.0                        10103.0   
122                         413256.0                        15682.0   
60                          258667.0                        18964.0   
204                         173594.0                        14110.0   
328                          69757.0                          494.0   
..                               ...                            ...   
123                         244129.0                         8669.0   
160                          52196.0                          847.0   
200                          58912.0                         4645.0   
427                         313955.0                         6924.0   
16                          387403.0                        17882.0   

     Home mortgage from personal seller amount  \
183                                      144.0   
122                                      356.0   
60                                       742.0   
204                                      182.0   
328                                        0.0   
..                                         ...   
123                                      258.0   
160                                        0.0   
200                                        0.0   
427                                       78.0   
16                                       411.0   

     Alternative minimum tax amount  Child and dependent care credit amount  
183                             0.0                                     0.0  
122                             0.0                                   119.0  
60                           2096.0                                     0.0  
204                           258.0                                    48.0  
328                             0.0                                     0.0  
..                              ...                                     ...  
123                             0.0                                     0.0  
160                             0.0                                     0.0  
200                             0.0                                     0.0  
427                             0.0                                    41.0  
16                            228.0                                   105.0  

[368 rows x 10 columns]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>Vehicle Count</td>
<td data-quarto-table-cell-role="th">R-squared:</td>
<td>0.761</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Adj. R-squared:</td>
<td>0.755</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>Least Squares</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
<td>126.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Fri, 12 Jul 2024</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
<td>1.79e-105</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>22:23:56</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-499.86</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>368</td>
<td data-quarto-table-cell-role="th">AIC:</td>
<td>1020.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>358</td>
<td data-quarto-table-cell-role="th">BIC:</td>
<td>1059.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>9</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">const</td>
<td>1.8742</td>
<td>0.081</td>
<td>23.261</td>
<td>0.000</td>
<td>1.716</td>
<td>2.033</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">State and local income tax refunds amount</td>
<td>-0.0021</td>
<td>0.001</td>
<td>-3.231</td>
<td>0.001</td>
<td>-0.003</td>
<td>-0.001</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Number of farm returns</td>
<td>-0.0024</td>
<td>0.001</td>
<td>-2.239</td>
<td>0.026</td>
<td>-0.004</td>
<td>-0.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total statutory adjustments amount</td>
<td>0.0003</td>
<td>5.02e-05</td>
<td>5.535</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Self-employed (Keogh) retirement plans amount</td>
<td>-0.0004</td>
<td>0.000</td>
<td>-3.238</td>
<td>0.001</td>
<td>-0.001</td>
<td>-0.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total standard deduction amount</td>
<td>5.762e-06</td>
<td>1.29e-06</td>
<td>4.466</td>
<td>0.000</td>
<td>3.22e-06</td>
<td>8.3e-06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Limited state and local taxes</td>
<td>7.658e-05</td>
<td>1.98e-05</td>
<td>3.875</td>
<td>0.000</td>
<td>3.77e-05</td>
<td>0.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Home mortgage from personal seller amount</td>
<td>-0.0015</td>
<td>0.001</td>
<td>-2.811</td>
<td>0.005</td>
<td>-0.003</td>
<td>-0.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Alternative minimum tax amount</td>
<td>-0.0003</td>
<td>0.000</td>
<td>-2.965</td>
<td>0.003</td>
<td>-0.001</td>
<td>-0.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Child and dependent care credit amount</td>
<td>-0.0132</td>
<td>0.002</td>
<td>-6.171</td>
<td>0.000</td>
<td>-0.017</td>
<td>-0.009</td>
</tr>
</tbody>
</table>
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Omnibus:</td>
<td>8.052</td>
<td data-quarto-table-cell-role="th">Durbin-Watson:</td>
<td>2.264</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Omnibus):</td>
<td>0.018</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>8.330</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Skew:</td>
<td>-0.361</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>0.0155</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>2.852</td>
<td data-quarto-table-cell-role="th">Cond. No.</td>
<td>2.80e+05</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br>[2] The condition number is large, 2.8e+05. This might indicate that there are<br>strong multicollinearity or other numerical problems.
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>_<span class="co"># model values</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>model_fitted_y <span class="op">=</span> results2mod.fittedvalues</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># model residuals</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>model_residuals <span class="op">=</span> results2mod.resid</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># normalized residuals</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>model_norm_residuals <span class="op">=</span> results2mod.get_influence().resid_studentized_internal</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># absolute squared normalized residuals</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>model_norm_residuals_abs_sqrt <span class="op">=</span> np.sqrt(np.<span class="bu">abs</span>(model_norm_residuals))</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># absolute residuals</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>model_abs_resid <span class="op">=</span> np.<span class="bu">abs</span>(model_residuals)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co"># leverage, from statsmodels internals</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>model_leverage <span class="op">=</span> results2mod.get_influence().hat_matrix_diag</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model_leverage)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="co"># cook's distance, from statsmodels internals</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>model_cooks <span class="op">=</span> results2mod.get_influence().cooks_distance[<span class="dv">0</span>]</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>plot_lm_1 <span class="op">=</span> plt.figure()</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>plot_lm_1.axes[<span class="dv">0</span>] <span class="op">=</span> sns.residplot(x<span class="op">=</span>model_fitted_y, y<span class="op">=</span>dataframe.columns[<span class="op">-</span><span class="dv">1</span>], data<span class="op">=</span>dataframe,</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>                          lowess<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>                          scatter_kws<span class="op">=</span>{<span class="st">'alpha'</span>: <span class="fl">0.5</span>},</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>                          line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'red'</span>, <span class="st">'lw'</span>: <span class="dv">1</span>, <span class="st">'alpha'</span>: <span class="fl">0.8</span>})</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>plot_lm_1.axes[<span class="dv">0</span>].set_title(<span class="st">'Residuals vs Fitted'</span>)</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>plot_lm_1.axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Fitted values'</span>)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>plot_lm_1.axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Residuals'</span>)</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> DataFrame()</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'res'</span>] <span class="op">=</span> model_residuals</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'fitted'</span>] <span class="op">=</span> model_fitted_y</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'count'</span>] <span class="op">=</span> dataframe[<span class="st">'Vehicle Count'</span>]</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'index'</span>] <span class="op">=</span> df.index</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>maxr <span class="op">=</span> np.<span class="bu">max</span>(model_residuals)</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>df.sort_values(<span class="st">'res'</span>, ascending<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0.01826582 0.03785969 0.04543135 0.0234968  0.00723828 0.03171761
 0.00642651 0.00654863 0.00658194 0.00626243 0.02694293 0.01873456
 0.05957668 0.00907219 0.02284818 0.00594722 0.073783   0.01944456
 0.00665368 0.04713534 0.01417589 0.00604659 0.01770531 0.05149057
 0.05001262 0.04177163 0.00701268 0.00677661 0.01512363 0.04380799
 0.02425046 0.02168542 0.09660976 0.05331764 0.05003466 0.00645461
 0.00633686 0.0193874  0.00565556 0.00634216 0.00693418 0.01954529
 0.00699271 0.03212044 0.00684816 0.05890323 0.01912411 0.00584276
 0.01579491 0.02814212 0.00405993 0.04443783 0.00595414 0.01190669
 0.00543733 0.00515628 0.01233832 0.01722907 0.00508592 0.00466313
 0.00673739 0.03864883 0.00679275 0.00644482 0.0729404  0.00653259
 0.00695707 0.01034472 0.00645669 0.00634573 0.01324778 0.02440872
 0.01495172 0.00740223 0.01118508 0.00545065 0.06980068 0.05138798
 0.05770356 0.01160956 0.007421   0.00666208 0.00943638 0.00549159
 0.07311905 0.00602169 0.00688146 0.00688993 0.00964655 0.00642827
 0.00617741 0.01217674 0.14535426 0.04458788 0.0085232  0.00744218
 0.00916964 0.00499047 0.00916999 0.00432108 0.01174652 0.01010192
 0.00704298 0.00625989 0.35129641 0.04291246 0.01950473 0.0053122
 0.06812042 0.00666897 0.01826247 0.00725049 0.00714309 0.01871208
 0.01800367 0.00601259 0.0062065  0.00427747 0.006046   0.00555226
 0.10344711 0.00605479 0.01922518 0.00586439 0.01203533 0.05496879
 0.01867398 0.0668914  0.03878636 0.00632942 0.06073942 0.00979867
 0.01528046 0.00715556 0.00576563 0.00678708 0.01660107 0.08012707
 0.00762994 0.01371691 0.02161798 0.00571191 0.17608257 0.01851592
 0.00771269 0.00655306 0.00681522 0.17619077 0.00623393 0.00696503
 0.03697875 0.06244216 0.00656931 0.00664473 0.04118542 0.00681567
 0.00677845 0.0068088  0.00556411 0.04170089 0.0893326  0.00705099
 0.00647661 0.05740234 0.00475146 0.00687506 0.01195452 0.00611871
 0.00652208 0.02405236 0.00580168 0.02545636 0.0069852  0.00662751
 0.04262806 0.02230357 0.01651007 0.00819182 0.00681122 0.008332
 0.0056768  0.00650944 0.01115727 0.00645498 0.00828628 0.00703888
 0.07141583 0.00767252 0.11282374 0.00804299 0.00556859 0.01176815
 0.01746095 0.00681537 0.00573176 0.01740679 0.01162859 0.00787792
 0.00601538 0.02497458 0.01063907 0.00578492 0.00999117 0.0065368
 0.01006015 0.22615261 0.02470853 0.04968953 0.00667764 0.00603132
 0.00704351 0.16711411 0.01058137 0.00619298 0.00635027 0.00605235
 0.01792562 0.01550256 0.00582353 0.04600884 0.03588416 0.02435629
 0.0067508  0.00629269 0.05298005 0.00498813 0.01529732 0.00671252
 0.01791051 0.00680738 0.00871376 0.00690323 0.03881791 0.04004842
 0.01860126 0.03098547 0.0553881  0.00647606 0.02015679 0.02725894
 0.00624714 0.0467556  0.02955691 0.14511755 0.02621133 0.00577774
 0.01518226 0.01026037 0.00691125 0.08743809 0.00947895 0.01148632
 0.00641168 0.00679506 0.01516531 0.00681971 0.00644699 0.03053979
 0.16789353 0.00628038 0.00617326 0.00600736 0.0182443  0.0063242
 0.06361348 0.00554867 0.0054997  0.00677444 0.00697612 0.00549322
 0.0974403  0.03137766 0.01209793 0.04412516 0.03667342 0.05569269
 0.12414163 0.00732518 0.00616196 0.03207757 0.00560366 0.04382424
 0.00687158 0.00708427 0.05225274 0.05231192 0.00698945 0.00570209
 0.00641915 0.00704037 0.01554064 0.00637216 0.00726666 0.00579208
 0.00489663 0.08850361 0.03811937 0.03120403 0.01274552 0.38491514
 0.02412663 0.0426812  0.02792734 0.01751975 0.10524453 0.08718712
 0.03439447 0.02788731 0.26896131 0.00635901 0.00571074 0.00960614
 0.00454068 0.00684715 0.04374796 0.00690139 0.03698676 0.21273836
 0.00430524 0.01370283 0.0063852  0.0053257  0.00525048 0.00836796
 0.08528426 0.00579692 0.00704388 0.2500851  0.03091241 0.00531262
 0.00703987 0.0076012  0.00645359 0.00668206 0.01016147 0.01949248
 0.00646614 0.01803629 0.00602622 0.00743028 0.03505315 0.0051745
 0.00940906 0.00642072 0.02186029 0.01172584 0.01635936 0.07120156
 0.10786753 0.00677022 0.00687978 0.0060841  0.006671   0.00624718
 0.03444653 0.02214775 0.00714578 0.03375703 0.00599259 0.10954852
 0.00995481 0.01536105 0.01175863 0.03469982 0.00532076 0.01179502
 0.02578448 0.03938476]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">res</th>
<th data-quarto-table-cell-role="th">fitted</th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">index</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">63</td>
<td>-2.622797</td>
<td>9.616730</td>
<td>6.993933</td>
<td>63</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>-2.109166</td>
<td>8.881101</td>
<td>6.771936</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">377</td>
<td>-2.032039</td>
<td>2.032039</td>
<td>0.000000</td>
<td>377</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">347</td>
<td>-1.994727</td>
<td>1.994727</td>
<td>0.000000</td>
<td>347</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">410</td>
<td>-1.960376</td>
<td>1.960376</td>
<td>0.000000</td>
<td>410</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">62</td>
<td>1.891785</td>
<td>4.524947</td>
<td>6.416732</td>
<td>62</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">106</td>
<td>1.972948</td>
<td>3.236538</td>
<td>5.209486</td>
<td>106</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">59</td>
<td>2.171148</td>
<td>3.434654</td>
<td>5.605802</td>
<td>59</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">55</td>
<td>2.383259</td>
<td>3.786352</td>
<td>6.169611</td>
<td>55</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">73</td>
<td>3.101186</td>
<td>2.113750</td>
<td>5.214936</td>
<td>73</td>
</tr>
</tbody>
</table>

<p>368 rows × 4 columns</p>
</div>
</div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-21-output-3.png" width="582" height="447"></p>
</div>
</div>
<section id="normal-q-q-plot-1" class="level4">
<h4 class="anchored" data-anchor-id="normal-q-q-plot-1">Normal Q-Q Plot</h4>
<p>This plot shows if the residuals are normally distributed. A good normal QQ plot has all of the residuals lying on or close to the red line.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>QQ <span class="op">=</span> ProbPlot(model_norm_residuals)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>plot_lm_2 <span class="op">=</span> QQ.qqplot(line<span class="op">=</span><span class="st">'45'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'#4C72B0'</span>, lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>plot_lm_2.axes[<span class="dv">0</span>].set_title(<span class="st">'Normal Q-Q'</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>plot_lm_2.axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Theoretical Quantiles'</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>plot_lm_2.axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Standardized Residuals'</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># annotations</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>abs_norm_resid <span class="op">=</span> np.flip(np.argsort(np.<span class="bu">abs</span>(model_norm_residuals)), <span class="dv">0</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>abs_norm_resid_top_3 <span class="op">=</span> abs_norm_resid[:<span class="dv">3</span>]</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r, i <span class="kw">in</span> <span class="bu">enumerate</span>(abs_norm_resid_top_3):</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    plot_lm_2.axes[<span class="dv">0</span>].annotate(i,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>                               xy<span class="op">=</span>(np.flip(QQ.theoretical_quantiles, <span class="dv">0</span>)[r],</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>                                   model_norm_residuals[i]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-22-output-1.png" width="582" height="447"></p>
</div>
</div>
</section>
<section id="scale-location-1" class="level4">
<h4 class="anchored" data-anchor-id="scale-location-1">Scale-Location</h4>
<p>This plot is a way to check if the residuals suffer from non-constant variance, aka heteroscedasticity.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>plot_lm_3 <span class="op">=</span> plt.figure()</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(model_fitted_y, model_norm_residuals_abs_sqrt, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>sns.regplot(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>model_fitted_y, </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>model_norm_residuals_abs_sqrt,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    scatter<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    ci<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    lowess<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'red'</span>, <span class="st">'lw'</span>: <span class="dv">1</span>, <span class="st">'alpha'</span>: <span class="fl">0.8</span>})</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>plot_lm_3.axes[<span class="dv">0</span>].set_title(<span class="st">'Scale-Location'</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>plot_lm_3.axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Fitted values'</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>plot_lm_3.axes[<span class="dv">0</span>].set_ylabel(<span class="st">'$\sqrt{|Standardized Residuals|}$'</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co"># annotations</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>abs_sq_norm_resid <span class="op">=</span> np.flip(np.argsort(model_norm_residuals_abs_sqrt), <span class="dv">0</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>abs_sq_norm_resid_top_3 <span class="op">=</span> abs_sq_norm_resid[:<span class="dv">3</span>]</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> r, i <span class="kw">in</span> <span class="bu">enumerate</span>(abs_sq_norm_resid_top_3):</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    plot_lm_3.axes[<span class="dv">0</span>].annotate(</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>        i,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=</span>(model_fitted_y[i],</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>        model_norm_residuals_abs_sqrt[i]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-23-output-1.png" width="608" height="447"></p>
</div>
</div>
</section>
<section id="residuals-vs.-leverage-1" class="level4">
<h4 class="anchored" data-anchor-id="residuals-vs.-leverage-1">Residuals vs.&nbsp;Leverage</h4>
<p>Unlike outliers, which have an unusually large y value, leverage points have extreme x values. This may not seem so bad at face value, but it can have damaging effects on the model because the β coefficients are very sensitive to leverage points. The purpose of the Residuals vs Leverage plot is to identify these problematic observations.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>plot_lm_4 <span class="op">=</span> plt.figure()</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(model_leverage, model_norm_residuals, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>sns.regplot(x<span class="op">=</span>model_leverage, y<span class="op">=</span>model_norm_residuals,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>            scatter<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>            ci<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>            lowess<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'red'</span>, <span class="st">'lw'</span>: <span class="dv">1</span>, <span class="st">'alpha'</span>: <span class="fl">0.8</span>})</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>plot_lm_4.axes[<span class="dv">0</span>].set_xlim(<span class="dv">0</span>, np.<span class="bu">max</span>(model_leverage)<span class="op">+</span><span class="fl">0.01</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>plot_lm_4.axes[<span class="dv">0</span>].set_ylim(<span class="op">-</span><span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>plot_lm_4.axes[<span class="dv">0</span>].set_title(<span class="st">'Residuals vs Leverage'</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>plot_lm_4.axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Leverage'</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>plot_lm_4.axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Standardized Residuals'</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># annotations</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>leverage_top_3 <span class="op">=</span> np.flip(np.argsort(model_cooks), <span class="dv">0</span>)[:<span class="dv">3</span>]</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> leverage_top_3:</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    plot_lm_4.axes[<span class="dv">0</span>].annotate(i,</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>                                xy<span class="op">=</span>(model_leverage[i],</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>                                    model_norm_residuals[i]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-24-output-1.png" width="582" height="447"></p>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cookdplot(model, ax<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    cooks_d <span class="op">=</span> model.get_influence().cooks_distance[<span class="dv">0</span>]</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    ax.vlines(<span class="bu">range</span>(<span class="bu">len</span>(cooks_d)),<span class="dv">0</span>,cooks_d)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># annotations</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    cookd_top_3 <span class="op">=</span> np.flip(np.argsort(cooks_d), <span class="dv">0</span>)[:<span class="dv">3</span>]</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> cookd_top_3:</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        ax.annotate(i, xy<span class="op">=</span>(i, cooks_d[i]),color <span class="op">=</span> <span class="st">'C3'</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">"Cook's Distance"</span> , fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Obs. Number'</span>)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">"Cook's distance"</span>)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ax</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>cookdplot(results2mod)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="eda-ev_files/figure-html/cell-25-output-1.png" width="593" height="447"></p>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>In this analysis, two models were compared: the initial linear regression model and a refined model with selected features. The refined model showed improved performance with higher R-squared and lower AIC values, indicating a better fit. The selection of features based on statistical significance helped in enhancing the model’s predictive accuracy. Ultimately, the refined model is preferred for predicting the number of electric vehicles in a given zip code due to its better performance metrics and more robust feature selection process.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>